version: 1
name: mcsqoe-paper-rigor
created_at_utc: "2026-02-06T00:00:00Z"

environment:
  go_version_min: "1.24.0"
  package: "./foundation_models"
  default_timeout: "20m"
  default_count: 1
  default_shuffle: "off"

tracks:
  - id: quality
    description: "MCQSMoE correctness and determinism checks"
    command: >
      go test -v -count=1 -shuffle=off -timeout=20m
      -run 'TestQSMoE(LayerCreation|ForwardBasic|RoutingDeterminism|Specialization|AuditEntropy|CombineMethods)$'
      ./foundation_models
    artifacts:
      - "results/logs/quality.log"

  - id: quality_multiseed
    description: "Quality robustness across fixed shuffle seeds"
    command: "./foundation_models/paper_mcsqoe/scripts/15_quality_multiseed_suite.sh"
    artifacts:
      - "results/logs/quality_multiseed.log"

  - id: performance
    description: "MCQSMoE and reference-path benchmark sweep"
    command: >
      go test -run '^$' -benchmem -benchtime=1s -count=1 -timeout=30m
      -bench 'Benchmark(QSMoEForward|QSMoEForwardLarge|ParallelForward_medium_b32|WorkspaceForward_medium_b32)$'
      ./foundation_models
    artifacts:
      - "results/logs/perf.log"

  - id: performance_multirun
    description: "Multi-run statistics with mean/std/95% CI for benchmark metrics"
    command: "./foundation_models/paper_mcsqoe/scripts/22_perf_multirun_ci_suite.sh"
    artifacts:
      - "results/logs/perf_multirun.log"
      - "results/perf_multirun_samples.tsv"
      - "results/perf_multirun_stats.csv"
      - "results/perf_multirun_summary.md"

  - id: trained_artifact_gate
    description: "Strict artifact-dependent parity tests (fails if exports are missing or skipped)"
    command: "./foundation_models/paper_mcsqoe/scripts/25_track_t_artifact_suite.sh"
    artifacts:
      - "results/logs/track_t.log"

  - id: environment_snapshot
    description: "Reproducibility metadata"
    command: "./foundation_models/paper_mcsqoe/scripts/00_env_snapshot.sh"
    artifacts:
      - "results/env_snapshot.txt"

outputs:
  summary_markdown: "results/summary.md"
  summary_json: "results/summary.json"
  report_template: "REPORT_TEMPLATE.md"
